  <style>
    :root {
      /* Base color palette */
      --color-green: #70AD47;
      --color-teal: #008080;
      --color-orange: #fa8e36;
      --color-yellow: #e4ac03;
      --color-black: #2a2a2a;
      --color-purple: #683e9b;
      --color-skyblue: #6bb3f6;
      --color-blue: #2e5688;
      --color-red: #c0514d;
      --color-magenta: #a500a1;
      
      /* Dark variants */      
      --color-green-dark: #548235;
      --color-teal-dark: #003F3E;
      --color-orange-dark: #c06216;
      --color-yellow-dark: #7F6000;
      --color-black-dark: #000000;
      --color-purple-dark: #352647;
      --color-skyblue-dark: #2665a0;
      --color-blue-dark: #1f3147;
      --color-red-dark: #8c3736;
      --color-magenta-dark: #490e49;
      
      /* Light variants */
      --color-green-light: #c3dbb8;
      --color-teal-light: #8fc6c6;
      --color-orange-light: #fdeada;
      --color-yellow-light: #f4e7af;
      --color-black-light: #d9d9d9;
      --color-purple-light: #eddbff;
      --color-skyblue-light: #b8e0ff;
      --color-blue-light: #dce6f2;
      --color-red-light: #f2dcdb;
      --color-magenta-light: #f1d4e0;
      
      /* Domain-specific colors */
      --domain-default-white: #ffffff;
      --domain-net: var(--color-green);
      --domain-net-dark: var(--color-green-dark);
      --domain-iam: var(--color-teal);
      --domain-iam-dark: var(--color-teal-dark);
      --domain-eng: var(--color-orange);
      --domain-eng-dark: var(--color-orange-dark);
      --domain-ast: var(--color-yellow);
      --domain-ast-dark: var(--color-yellow-dark);
      --domain-rsk: var(--color-black);
      --domain-rsk-dark: var(--color-black-dark);
      --domain-tst: var(--color-purple);
      --domain-tst-dark: var(--color-purple-dark);
      --domain-sof: var(--color-skyblue);
      --domain-sof-dark: var(--color-skyblue-dark);
      --domain-ops: var(--color-red);
      --domain-ops-dark: var(--color-red-dark);
    }

    body {
      background: white;
      font-family: sans-serif;
      margin: 2vmax;
    }

    #roadmap {
      display: flex;
      flex-direction: column;
      gap: 2vmax;
    }

    .domain-container {
      background: white;
      position: relative;
      border: 2px solid;
      border-radius: 0.4vmax;
      padding: 0.4vmax; /* Padding inside domain matches external spacing */
      display: grid;
      grid-template-rows: repeat(29, 1.5vmax); /* 1 top buffer for subdomain title + 27 skill rows + 1 bottom buffer */
      gap: 0.1vmax; /* Matches tile and container gutter */
      width: max-content; /* Prevent full-width stretching */
    }

    .subdomain-container {
      position: relative;
      justify-content: center;
      border: 1px solid;
      padding: 0.1vmax; /* Equal to tile gutter for clean alignment */
      display: grid;
      grid-template-rows: repeat(28, 1.5vmax);
      grid-auto-rows: 1.5vmax;
      gap: 0.1vmax; /* Matches tile gap */
      border-radius: 0.25vmax;
      justify-content: center;
    }

    .subdomain-canvas {
      border-radius: 0.25vmax;
      z-index: 0;
      pointer-events: none;
      position: relative;
    }


    .subdomain-title {
      grid-row: 1;                              /* Place in row 1 */
      grid-column-start: var(--col-start);     /* We'll replace this dynamically */
      grid-column-end: span var(--col-span);   /* This too */
      text-align: center;
      font-weight: 400;
      font-size: 0.7vmax;
      line-height: 1;
      padding: 0.05vmax 0 0 0;
      margin: 0;
      align-self: end; /* Aligns the title to the bottom of its row */
      z-index: 1; /* Ensures title sits above tiles if they overlap */
    }


    .unspecialized-container {
      background-color: var(--domain-default-white);
      border: none;
      padding: 0.3vmax;
      display: grid;
      grid-template-rows: repeat(27, 1.5vmax);  /* 27 fixed rows for skill strata */
      grid-auto-rows: 1.5vmax;
      gap: 0.1vmax;
    }

    .cert-tile {
      width: 2.3vmax;
      height: 1.5vmax;
      display: flex;
      align-items: center;        /* vertically center content *inside* the tile */
      justify-content: center;    /* horizontally center content *inside* the tile */
      justify-self: center;    /* horizontally center the tile in its column */
      align-self: center;        /* center tile vertically in its grid row */
      text-align: center;
      font-size: 0.65vmax;
      font-weight: 400;
      border-radius: 0.25vmax;
      background-color: inherit;  /* Inherit from parent */
      border: 1px solid;          /* Use inherited border-color */
      color: white;               /* Set text color explicitly */
      padding: 0.2vmax;
      box-sizing: border-box;
      margin: 0;
      text-decoration: none;
    }

    /* Domain-specific border and title coloring */
    .domain-NET     { border-color: var(--domain-net); }
    .domain-IAM     { border-color: var(--domain-iam); }
    .domain-ENG     { border-color: var(--domain-eng); }
    .domain-AST     { border-color: var(--domain-ast); }
    .domain-RSK     { border-color: var(--domain-rsk); }
    .domain-TST     { border-color: var(--domain-tst); }
    .domain-SOF     { border-color: var(--domain-sof); }
    .domain-OPS     { border-color: var(--domain-ops); }

    .domain-NET     .domain-title { color: var(--domain-net); }
    .domain-IAM     .domain-title { color: var(--domain-iam); }
    .domain-ENG     .domain-title { color: var(--domain-eng); }
    .domain-AST     .domain-title { color: var(--domain-ast); }
    .domain-RSK     .domain-title { color: var(--domain-rsk); }
    .domain-TST     .domain-title { color: var(--domain-tst); }
    .domain-SOF     .domain-title { color: var(--domain-sof); }
    .domain-OPS     .domain-title { color: var(--domain-ops); }


  </style>
</head>
<body>

  <h1>Security Certification Roadmap</h1>
  <div id="roadmap"></div>

  <script>
    async function loadJSON(path) {
      const res = await fetch(path);
      return res.json();
    }

    function applyGridSpanStyles(element) {
      const colStart = element.getAttribute('data-grid-column-start');
      const colSpan = element.getAttribute('data-grid-column-span');

      if (colStart && colSpan) {
        element.style.setProperty('--col-start', colStart);
        element.style.setProperty('--col-span', colSpan);
      }
    }

    async function drawRoadmap() {
      const [domains, subdomains, certs] = await Promise.all([
        loadJSON('./data/domains.json'),
        loadJSON('./data/subdomains.json'),
        loadJSON('./data/certs.json'),
      ]);

      const roadmapEl = document.getElementById('roadmap');

      domains.forEach(domain => {
        const domainDiv = document.createElement('div');
        domainDiv.classList.add('domain-container', `domain-${domain.domainId}`);

        // ðŸ”§ Dynamically set how wide the domain container should be
        const allContainers = subdomains.filter(sd => sd.domainId === domain.domainId);

        let maxColumn = 0;
        allContainers.forEach(c => {
          const endCol = c.gridColumnStart + c.gridColumnSpan - 1;
          if (endCol > maxColumn) maxColumn = endCol;
        });

        domainDiv.style.gridTemplateColumns = `repeat(${maxColumn}, 2.3vmax)`;

      const domainSubdomains = subdomains.filter(sd => sd.domainId === domain.domainId);
      domainSubdomains.forEach(sub => {
        
        // ðŸ”¹ Subdomain title
        if (!sub.subdomainId.endsWith('_unspec')) {
          const subTitle = document.createElement('div');
          subTitle.className = 'subdomain-title';
          subTitle.textContent = sub.subdomainShortName;
          subTitle.style.gridRowStart = 1;
          subTitle.style.gridColumnStart = sub.gridColumnStart;
          subTitle.style.gridColumnEnd = `span ${sub.gridColumnSpan}`;
          domainDiv.appendChild(subTitle);
        }

        // ðŸ”¹ Subdomain container
        const subDiv = document.createElement('div');
        subDiv.classList.add('subdomain-container', `subdomain-${sub.subdomainId}`);

        subDiv.style.gridTemplateColumns = `repeat(${sub.gridColumnSpan}, 2.3vmax)`;
        subDiv.style.gridTemplateRows = `repeat(27, 1.5vmax)`; // consistent vertical grid

        subDiv.style.gridColumnStart = sub.gridColumnStart;
        subDiv.style.gridColumnEnd = `span ${sub.gridColumnSpan}`;
        subDiv.style.gridRowStart = sub.gridRowStart;
        subDiv.style.gridRowEnd = `span ${sub.gridRowSpan}`;

        // ðŸ”¹ Subdomain canvas (visual layer behind container)
        const canvas = document.createElement('div');
        canvas.classList.add('subdomain-canvas');
        canvas.setAttribute('data-subdomain-id', sub.subdomainId);

        // positioning based on grid math
        canvas.style.gridRowStart = sub.gridRowStart;
        canvas.style.gridRowEnd = `span ${sub.gridRowSpan}`;
        canvas.style.gridColumnStart = sub.gridColumnStart;
        canvas.style.gridColumnEnd = `span ${sub.gridColumnSpan}`;

        canvas.style.position = 'relative';
        canvas.style.zIndex = 0;
        canvas.style.pointerEvents = 'none';
        canvas.style.backgroundColor = sub.subdomainId.endsWith('_unspec')
          ? 'transparent'
          : `var(${sub.subdomainColor || '--domain-default-white'})`;

        domainDiv.appendChild(canvas); // Must go before the subdomain container

        // ðŸ”¹ Add cert tiles
        const subCerts = certs.filter(cert => cert.subdomainId === sub.subdomainId);
        const tileRowMap = {};

        subCerts.forEach(cert => {
          const tile = makeCertTile(cert, domains);
          const skillRow = cert.certSkillStrata;

          if (!tileRowMap[skillRow]) {
            tileRowMap[skillRow] = 1;
          } else {
            tileRowMap[skillRow]++;
          }

          tile.style.gridRowStart = skillRow;
          tile.style.gridColumnStart = tileRowMap[skillRow];

          subDiv.appendChild(tile);
        });

        domainDiv.appendChild(subDiv);
      });

      /*
      // ðŸ”¹ External domain title aligned to container span
      const domainTitle = document.createElement('div');
      domainTitle.className = 'domain-title';
      domainTitle.textContent = domain.domainShortName;

      // Use same alignment as container
      const domainColumnStart = Math.min(...allContainers.map(c => c.gridColumnStart));
      domainTitle.style.gridColumnStart = domainColumnStart;
      domainTitle.style.gridColumnEnd = `span ${domain.gridColumnSpan}`;
      */

      roadmapEl.appendChild(domainDiv);
      });
    }

    function makeCertTile(cert, domains) {
      const tile = document.createElement('a');
      tile.href = cert.certUrl;
      tile.target = '_blank';
      tile.className = 'cert-tile';
      tile.textContent = cert.certTileLabel;
      tile.title = cert.certTooltip;
      tile.setAttribute('data-cert-id', cert.certId);
      tile.setAttribute('data-domain-id', cert.domainId);
      if (cert.subdomainId) {
        tile.setAttribute('data-subdomain-id', cert.subdomainId);
      }

      tile.style.gridRowStart = cert.certSkillStrata;

      // Apply color logic from domain and optional teamRole
      const domain = domains.find(d => d.domainId === cert.domainId);
      const teamRoles = domain.teamRoles || {};
      const role = cert.teamRole || "DefaultTeam";

      if (teamRoles[role] && teamRoles[role].tileColor && teamRoles[role].borderColor) {
      tile.style.backgroundColor = `var(${teamRoles[role].tileColor})`;
      tile.style.borderColor = `var(${teamRoles[role].borderColor})`;
    } else {
      const domainIdLower = cert.domainId.toLowerCase();
      tile.style.backgroundColor = `var(--domain-${domainIdLower})`;
      tile.style.borderColor = `var(--domain-${domainIdLower}-dark)`;
    }

    tile.style.color = 'white'; // force white font

      return tile;
    }


    drawRoadmap();
  </script>