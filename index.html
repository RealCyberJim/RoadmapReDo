
  <style>
    /* 03JUN2025 2316 - last commit prior to skill level refactor*/
    :root {
      --domain-count: 8; /* ‚Üê TEMPORARY fallback for CSS grid */

      

      /* Base color palette */
      --color-green: #70AD47;
      --color-teal: #008080;
      --color-orange: #fa8e36;
      --color-yellow: #e4ac03;
      --color-black: #2a2a2a;
      --color-purple: #683e9b;
      --color-skyblue: #6bb3f6;
      --color-blue: #2e5688;
      --color-red: #c0514d;
      --color-magenta: #a500a1;
      
      /* Dark variants */      
      --color-green-dark: #548235;
      --color-teal-dark: #003F3E;
      --color-orange-dark: #c06216;
      --color-yellow-dark: #7F6000;
      --color-black-dark: #000000;
      --color-purple-dark: #352647;
      --color-skyblue-dark: #2665a0;
      --color-blue-dark: #1f3147;
      --color-red-dark: #8c3736;
      --color-magenta-dark: #490e49;
      
      /* Light variants */
      --color-green-light: #c3dbb8;
      --color-teal-light: #8fc6c6;
      --color-orange-light: #fdeada;
      --color-yellow-light: #f4e7af;
      --color-black-light: #d9d9d9;
      --color-purple-light: #eddbff;
      --color-skyblue-light: #b8e0ff;
      --color-blue-light: #dce6f2;
      --color-red-light: #f2dcdb;
      --color-magenta-light: #f1d4e0;
      
      /* Domain-specific colors */
      --domain-default-white: #ffffff;
      --domain-net: var(--color-green);
      --domain-net-dark: var(--color-green-dark);
      --domain-net-light: var(--color-green-light);
      --domain-iam: var(--color-teal);
      --domain-iam-dark: var(--color-teal-dark);
      --domain-iam-light: var(--color-teal-light);
      --domain-eng: var(--color-orange);
      --domain-eng-dark: var(--color-orange-dark);
      --domain-eng-light: var(--color-orange-light);
      --domain-ast: var(--color-yellow);
      --domain-ast-dark: var(--color-yellow-dark);
      --domain-ast-light: var(--color-yellow-light);
      --domain-rsk: var(--color-black);
      --domain-rsk-dark: var(--color-black-dark);
      --domain-rsk-light: var(--color-black-light);
      --domain-tst: var(--color-purple);
      --domain-tst-dark: var(--color-purple-dark);
      --domain-tst-light: var(--color-purple-light);
      --domain-sof: var(--color-skyblue);
      --domain-sof-dark: var(--color-skyblue-dark);
      --domain-sof-light: var(--color-skyblue-light);
      --domain-ops: var(--color-red);
      --domain-ops-dark: var(--color-red-dark);
      --domain-ops-light: var(--color-red-light);


      --domain-title-height: 2.8vmax;
    }

    /* Domain-specific border and title coloring */
    .domain-NET     { border-color: var(--domain-net); }
    .domain-IAM     { border-color: var(--domain-iam); }
    .domain-ENG     { border-color: var(--domain-eng); }
    .domain-AST     { border-color: var(--domain-ast); }
    .domain-RSK     { border-color: var(--domain-rsk); }
    .domain-TST     { border-color: var(--domain-tst); }
    .domain-SOF     { border-color: var(--domain-sof); }
    .domain-OPS     { border-color: var(--domain-ops); }
    .domain-SKL     { border-color: transparent; }  /* No border for skill domain */

    .domain-NET .domain-title {
      background-color: var(--domain-net-light);
      color: var(--domain-net-dark);
    }
    .domain-IAM .domain-title {
      background-color: var(--domain-iam-light);
      color: var(--domain-iam-dark);
    }
    .domain-ENG .domain-title {
      background-color: var(--domain-eng-light);
      color: var(--domain-eng-dark);
    }
    .domain-AST .domain-title {
      background-color: var(--domain-ast-light);
      color: var(--domain-ast-dark);
    }
    .domain-RSK .domain-title {
      background-color: var(--domain-rsk-light);
      color: var(--domain-rsk-dark);
    }
    .domain-TST .domain-title {
      background-color: var(--domain-tst-light);
      color: var(--domain-tst-dark);
    }
    .domain-SOF .domain-title {
      background-color: var(--domain-sof-light);
      color: var(--domain-sof-dark);
    }
    .domain-OPS .domain-title {
      background-color: var(--domain-ops-light);
      color: var(--domain-ops-dark);
    }
    .domain-SKL .domain-title {
      background-color: transparent;
      color: var(--color-black-dark);
      border: none;
    }  /* No background or border for skill domain title */

    /* BEGIN Dark Mode Styling */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }

    body.dark-mode .domain-container {
      background-color: #1e1e1e;
      border-color: #444;
    }

    body.dark-mode .cert-tile {
      background-color: inherit;
      border-color: #555;
      color: white;
    }

    body.dark-mode .subdomain-canvas {
      opacity: 0.15; /* Subtle, but visible on dark bg */
    }

    /* END Dark Mode Styling */

    html, body {
      overflow-x: hidden;
      overflow-y: auto;
      height: 100%;
    }

    body {
      background: white;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }

    #roadmap-flex {
      display: flex;
      justify-content: flex-start; /* default: left-aligned */
      width: 100%;
    }
    
    body.center-domains #roadmap-flex {
      justify-content: center; /* center when this class is active */
    }

    #roadmap-wrapper {
      display: grid;
      grid-template-columns: 1vmax 1fr; /* LEFT: skill label column, RIGHT: roadmap */
      grid-template-rows: auto auto;
      width: 100%;
      max-width: 100vw;
      height: auto;
      max-height: none !important;
      overflow-x: hidden;
      overflow-y: visible;
      box-sizing: border-box;
      position: relative;
    }
        
    #roadmap {
      display: flex;
      overflow-x: hidden;
      width: 100%;
      align-items: start;
      flex-direction: row;
      flex-wrap: nowrap;
      gap: 0.2vmax;
      grid-column: 2;
      grid-row: 2;
      max-height: none;
      max-width: 100%;
      min-width: 0;
      overflow-y: visible;
      padding-right: 0.2vmax;
    }
    
    body.center-domains #roadmap {
      justify-content: center; /* Override to center */
    }


    /* Domain Container Styles */
    
    /* Base domain container - structural styles */
    .domain-container {
      position: relative;
      display: grid;
      grid-template-rows: repeat(28, 1.5vmax);
      gap: 0.1vmax;
      width: max-content;
      padding: 0.05vmax 0.2vmax 0.2vmax 0.2vmax;
    }

    /* Standard domain visual styles */
    .domain-container:not(.domain-SKL) {
      background: white;
      border: 2px solid;
      border-radius: 0.25vmax;
    }

    /* Skill domain specific styles */
    .domain-SKL.domain-container {
      background: transparent;
      border: none;
    }

    .domain-unit {
      display: flex; /* New addition */
      flex-direction: column; /* Stack items vertically */
      width: min-content; /* Shrink to fit content */
      align-items: center; /* Center items horizontally */
      gap: 0.1vmax; /* Space between items */
      flex: 0 0 auto; /* Prevent shrinking */
      margin: 0; /* No margin to prevent shifting */
      padding: 0; /* No padding to prevent shifting */
      min-width: 0; /* Prevent overflow */
      max-width: none; /* Prevent overflow */
    }

    /* Base domain title - structural styles */
    .domain-title {
      position: relative;
      z-index: 3;
      width: 100%;
      box-sizing: border-box;
      text-align: center;
      font-weight: 500;
      font-size: 0.8vmax;
      padding: 0.2vmax 0;
      max-width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      height: var(--domain-title-height);
      margin: 0;
      line-height: 1;
    }

    /* Standard domain titles */
    .domain-container:not(.domain-SKL) .domain-title {
        border: 2px solid;
        border-radius: 0.25vmax;
    }

    /* Skill domain title styles - removes border */
    .domain-SKL .domain-title {
      border: none;
      background: none;
      color: transparent;
    }

    .domain-wrapper { /* Wrapper for domain title + domain container */
      display: grid;            /* Grid for title + domain container */
      grid-template-rows: auto 1fr; /* Title row on top, domain container below */
      width: max-content;           /* Shrinks to fit the domain */
      margin: 0;                   /* No margin to prevent shifting */
      padding: 0;                  /* No padding to prevent shifting */
    }
    
    .subdomain-container {     /* Container for each subdomain within a domain */
      position: relative;             /* Enables absolute positioning for title */
      padding-top: 1vmax;             /* Reserve space for overlay title */
      padding: 0.1vmax 0.1vmax 0.1vmax 0.1vmax;
      display: grid;
      grid-template-rows: repeat(28, 1.5vmax); /* Only rows for cert tiles */
      grid-auto-rows: 1.5vmax;
      gap: 0.1vmax;
      border-radius: 0.25vmax;
      justify-content: center;
      border: none;
    }
        
    .subdomain-canvas {          /* Background "canvas" for subdomain */
      border-radius: 0.25vmax;
      z-index: 0;              /* Keep behind tiles and labels */
      pointer-events: none;
      position: absolute;      /* Better isolation from layout flow */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }

    .subdomain-title {          /* small title at the top of the subdomain canvas */
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1vmax;
      text-align: center;
      font-size: 0.6vmax;
      font-weight: 500;
      padding-top: 0.1vmax;
      pointer-events: none;
      white-space: normal;
      word-break: break-word;
      overflow-wrap: break-word;
      z-index: 2;
    }

    .cert-tile {                  /* Individual certification tile */
      width: 2.3vmax;
      height: 1.5vmax;
      display: flex;
      align-items: center;        /* vertically center content *inside* the tile */
      justify-content: center;    /* horizontally center content *inside* the tile */
      justify-self: center;    /* horizontally center the tile in its column */
      align-self: center;        /* center tile vertically in its grid row */
      text-align: center;
      font-size: 0.6vmax;
      font-weight: 400;
      border-radius: 0.25vmax;
      background-color: inherit;  /* Inherit from parent */
      border: 1px solid;          /* Use inherited border-color */
      color: white;               /* Set text color explicitly */
      padding: 0.2vmax;
      box-sizing: border-box;
      margin: 0;
      text-decoration: none;
    }

    /* Skill domain specific subdomain title styling */
    .domain-SKL .subdomain-title {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) rotate(270deg);
      transform-origin: center;
      white-space: nowrap;
      padding: 0.4vmax;
      font-size: 0.9vmax;
      font-weight: bold;
      background-color: transparent;
      color: var(--color-black-dark);
      width: auto;
      text-align: center;
      z-index: 1;
    }

    /* .skill-tile ‚Äî Atomic visual unit for skill strata placement */
    /* Mirrors .cert-tile in layout, with half width for vertical labeling */
    .skill-tile {                  /* Skill tile for skill column */
      width: 1.15vmax;             /* Half width of .cert-tile */
      height: 1.5vmax;             /* Match tile row height */
      display: flex;
      align-items: center;         /* Vertically center label inside tile */
      justify-content: center;     /* Horizontally center label inside tile */
      justify-self: center;        /* Center the tile inside the grid cell */
      align-self: center;          /* Vertically center the tile inside its row */
      text-align: center;
      font-size: 0.6vmax;
      font-weight: 400;
      border-radius: 0.25vmax;     /* Match .cert-tile curvature */
      background-color: var(--color-black-light); /* Temporary neutral background */
      border: 1px solid var(--color-black-dark);  /* Darker contrast border */
      color: white;
      padding: 0.2vmax;            /* Slightly tighter padding for narrow label */
      box-sizing: border-box;
      margin: 0;
      text-decoration: none;
      pointer-events: none;                    /* Not interactive for now */
    }

    /* For all domain titles */
    .domain-title {
      background-color: transparent; /* Fallback if no domain-specific color */
    }

    /* For RSK domain specifically */
    .domain-RSK .domain-title {
      background-color: var(--domain-rsk-light) !important;
      color: var(--domain-rsk-dark) !important;
    }

    /* Lock it down in dark mode as well */
    body.dark-mode .domain-RSK .domain-title {
      background-color: var(--domain-rsk-light) !important;
      color: var(--domain-rsk-dark) !important;
    }
    
   /*
   // ======================================================
   // TEMPORARY DEBUG VISUAL BORDERS ‚Äî FOR ALIGNMENT TESTING
   // ======================================================
   */


   /*
   // ======================================================
   // END GRID DEBUG MODE
   // ======================================================
   */

    
  </style>
</head>
<link rel="icon" href="data:,"> <!-- Prevents favicon request -->
<body>
<!-- Filter Control Panel -->
  </div>
</div>


<!-- Dark Mode Toggle -->
<div id="dark-mode-toggle" style="padding: 0.5vmax; font-size: 0.75vmax;">
  <label>
    <input type="checkbox" id="dark-mode-checkbox" />
    Enable Dark Mode
  </label>
</div>
<div>
  <label style="margin-left: 2vmax;">
    Vendor Filter:
    <select id="vendor-filter">
      <option value="__ALL__">All Vendors</option>
    </select>
</label>
</div>
<!-- Dynamic Domain Filter Checkboxes -->
<div id="domain-checkboxes" style="padding: 0.5vmax 0; font-size: 0.75vmax;"></div>

  <h1>Security Certification Roadmap</h1>
<div id="roadmap-flex">
  <div id="roadmap-wrapper">
    <div id="roadmap">
    </div>
  </div>
</div>
<!-- Spacer below roadmap -->
<div style="height: 2vmax;"></div>


<script>

// =============================================================================
// RESERVED FOR TEMPORARY DEBUGGING /* Remove before production deployment */
// =============================================================================



// =============================================================================
// RESERVED FOR TEMPORARY DEBUGGING /* Remove before production deployment */
// =============================================================================


// Centralized filter state ‚Äî controls what gets shown on the roadmap
    const filterState = {
      visibleDomains: [], // filled after loading domains.json
      visibleVendors: [], // filled after loading certs.json
      showAchieved: true,
      showPlanned: true
    };

    //
    async function loadJSON(path) {
      const res = await fetch(path);
      return res.json();
    }

    function applyGridSpanStyles(element) {
      const colStart = element.getAttribute('data-grid-column-start');
      const colSpan = element.getAttribute('data-grid-column-span');

      if (colStart && colSpan) {
        element.style.setProperty('--col-start', colStart);
        element.style.setProperty('--col-span', colSpan);
      }
    }

    function usedSkillRowsHasRowsInRange(start, end, usedSkillRows) {
      for (let i = start; i <= end; i++) {
        if (usedSkillRows.has(i)) return true;
      }
      return false;
    }

    function getCenterOutwardColumnOrder(span) {
      const center = Math.ceil(span / 2);
      const order = [center];

      for (let offset = 1; order.length < span; offset++) {
        if (center + offset <= span) order.push(center + offset);
        if (center - offset >= 1) order.push(center - offset);
      }

      return order;
    }

    /**
     * Draws the roadmap with domains, subdomains, and certifications.
     * @param {Array} domains - List of domain objects.
     * @param {Array} subdomains - List of subdomain objects.
     * @param {Array} certs - List of certification objects.
     */
    function drawRoadmap(domains, subdomains, certs) {

      const roadmapEl = document.getElementById('roadmap');



      domains
        .filter(domain => filterState.visibleDomains.includes(domain.domainId))
        .forEach(domain => {
        const domainDiv = document.createElement('div');
        domainDiv.classList.add('domain-container', `domain-${domain.domainId}`);
        domainDiv.style.gridTemplateRows = 'repeat(28, 1.5vmax)';
        domainDiv.style.borderColor = `var(--domain-${domain.domainId.toLowerCase()}-dark)`;

        // Dynamically set how wide the domain container should be
        const allContainers = subdomains.filter(sd => sd.domainId === domain.domainId);

        let maxColumn = 0;
        allContainers.forEach(c => {
          const endCol = c.gridColumnStart + c.gridColumnSpan - 1;
          if (endCol > maxColumn) maxColumn = endCol;
        });

        domainDiv.style.gridTemplateColumns = `repeat(${maxColumn}, 2.3vmax)`;

      const domainSubdomains = subdomains.filter(sd => sd.domainId === domain.domainId);
      domainSubdomains.forEach(sub => {

        // Subdomain container
        const subDiv = document.createElement('div');
        subDiv.classList.add('subdomain-container', `subdomain-${sub.subdomainId}`);

        subDiv.style.gridTemplateColumns = `repeat(${sub.gridColumnSpan}, 2.3vmax)`;
        subDiv.style.gridTemplateRows = 'repeat(28, 1.5vmax)';

        subDiv.style.gridColumnStart = sub.gridColumnStart;
        subDiv.style.gridColumnEnd = `span ${sub.gridColumnSpan}`;
        subDiv.style.gridRowStart = sub.gridRowStart;
        subDiv.style.gridRowEnd = `span ${sub.gridRowSpan}`;

        // Subdomain canvas (visual layer behind container)
        const canvas = document.createElement('div');
        canvas.classList.add('subdomain-canvas');
        canvas.setAttribute('data-subdomain-id', sub.subdomainId);

        // positioning based on grid math
        canvas.style.gridRowStart = sub.gridRowStart;
        canvas.style.gridRowEnd = `span ${sub.gridRowSpan}`;
        canvas.style.gridColumnStart = sub.gridColumnStart;
        canvas.style.gridColumnEnd = `span ${sub.gridColumnSpan}`;

        canvas.style.position = 'relative';
        canvas.style.zIndex = 0;
        canvas.style.pointerEvents = 'none';
        canvas.style.backgroundColor = sub.subdomainId.endsWith('_unspec')
          ? 'transparent'
          : `var(${sub.subdomainColor || '--domain-default-white'})`;
        
                
        // Subdomain title overlay handling
        if (!sub.subdomainId.endsWith('_unspec')) {
          const titleOverlay = document.createElement('div');
          titleOverlay.className = 'subdomain-title';
          titleOverlay.textContent = sub.subdomainShortName;
          
          if (domain.domainId === 'SKL') {
            // SKL domain titles go in the subDiv for rotated vertical display
            subDiv.appendChild(titleOverlay);
          } else {
            // Non-SKL domain titles go on the canvas background
            canvas.appendChild(titleOverlay);
          }
        }

        domainDiv.appendChild(canvas); // Must go before the subdomain container

        // Add cert tiles - only show certs that directly belong to this subdomain
        const subCerts = certs.filter(cert => cert.subdomainId === sub.subdomainId);

        // Skip rendering this subdomain if it has no visible certs
        const visibleSubCerts = subCerts.filter(cert => 
          filterState.visibleVendorIds.includes(cert.vendorId)
        );

        if (visibleSubCerts.length === 0) return;

        const tileRowMap = {}; // { skillRow: currentTileIndex }
        const columnOrders = {}; // { skillRow: [col1, col2, ...] }

        // Render all certs that belong to this subdomain
        subCerts.forEach(cert => {
          if (!filterState.visibleVendorIds.includes(cert.vendorId)) return;

          const tile = makeCertTile(cert, domains, domain.domainId, sub.subdomainId);
          const skillRow = cert.certSkillStrata; // Used for grid positioning only

          if (!tileRowMap[skillRow]) {
            tileRowMap[skillRow] = 0;
            columnOrders[skillRow] = getCenterOutwardColumnOrder(sub.gridColumnSpan);
          }
          const colIndex = tileRowMap[skillRow];
          const colStart = columnOrders[skillRow][colIndex];
          tileRowMap[skillRow]++;

          tile.style.gridRowStart = skillRow;
          tile.style.gridColumnStart = colStart;
          subDiv.appendChild(tile);
        });

        domainDiv.appendChild(subDiv);
      });

      // Wrap domain content in a domain-wrapper
      const wrapper = document.createElement('div');
      wrapper.className = 'domain-wrapper';
      wrapper.appendChild(domainDiv);                     // Add the domain container
      // Create the domain title
      const domainTitle = document.createElement('div');
      domainTitle.className = 'domain-title';
      domainTitle.textContent = domain.domainShortName;
      domainTitle.style.color = `var(--domain-${domain.domainId.toLowerCase()}-dark)`;
      domainTitle.style.backgroundColor = `var(--domain-${domain.domainId.toLowerCase()}-light)`;
      domainTitle.style.textAlign = 'center';
      domainTitle.style.width = '100%';
      domainTitle.style.whiteSpace = 'normal';
      domainTitle.style.wordBreak = 'normal';
      domainTitle.style.overflowWrap = 'break-word';
      domainTitle.style.textOverflow = 'unset';
      domainTitle.style.overflow = 'visible';

      const domainUnit = document.createElement('div');
      domainUnit.className = 'domain-unit';
      domainUnit.style.gridColumnStart = domain.domainDisplayOrder + 1;
      domainUnit.appendChild(domainTitle);
      domainUnit.appendChild(wrapper);

      roadmapEl.appendChild(domainUnit);

      });
    }

    function makeCertTile(cert, domains, renderedDomainId, renderedSubdomainId) {
      const tile = document.createElement('a');
      tile.href = cert.certUrl;
      tile.target = '_blank';
      tile.className = 'cert-tile';
      tile.textContent = cert.certTileLabel;
      tile.title = cert.certTooltip;
      tile.setAttribute('data-cert-id', cert.certId);
      tile.setAttribute('data-domain-id', cert.domainId);
      if (cert.subdomainId) {
        tile.setAttribute('data-subdomain-id', cert.subdomainId);
      }

      tile.style.gridRowStart = cert.certSkillStrata;

      const domain = domains.find(d => d.domainId === cert.domainId);
      const teamRoles = domain.teamRoles || {};
      const role = cert.teamRole || "DefaultTeam";
      const domainIdLower = cert.domainId.toLowerCase();

      if (teamRoles[role] && teamRoles[role].tileColor) {
        const colorVar = teamRoles[role].tileColor;
        const borderVar = teamRoles[role].borderColor || `--domain-${domainIdLower}-dark`;

        tile.style.backgroundColor = `var(${colorVar})`;
        tile.style.borderColor = `var(${borderVar})`;
        tile.style.color = 'white';
      } else {
        tile.style.backgroundColor = `var(--domain-${domainIdLower})`;
        tile.style.borderColor = `var(--domain-${domainIdLower}-dark)`;
        tile.style.color = 'white';
      }

      return tile;
    }

    function updateDomainCenteringClass(domains) {
      const body = document.body;
      const allDomainIds = domains.map(d => d.domainId);
      const visible = filterState.visibleDomains;

      const isSubset = visible.length > 0 && visible.length < allDomainIds.length;

      if (isSubset) {
        body.classList.add("center-domains");
      } else {
        body.classList.remove("center-domains");
      }
    }

    // Master redraw function ‚Äî uses current filterState to rebuild roadmap
    function applyFiltersAndRedraw() {
      console.log("Redrawing with current filters:", filterState);

      const roadmapEl = document.getElementById("roadmap");
      roadmapEl.innerHTML = ""; // Clear all roadmap content

      updateDomainCenteringClass(window.loadedDomains);

      drawRoadmap(
        window.loadedDomains,
        window.loadedSubdomains,
        window.loadedCerts
      );
    }

    Promise.all([
      loadJSON('./data/domains.json'),
      loadJSON('./data/subdomains.json'),
      loadJSON('./data/certs.json'),
      loadJSON('./data/vendors.json'),
    ]).then(([domains, subdomains, certs, vendors]) => {

      // Seed the filter state with all available domains and vendors
      filterState.visibleDomains = domains.map(d => d.domainId);
      // Populate domain checkboxes
      const domainCheckboxes = document.getElementById("domain-checkboxes");
      domains.forEach(domain => {
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = `domain-${domain.domainId}`;
        checkbox.value = domain.domainId;
        checkbox.checked = true;

        const label = document.createElement("label");
        label.htmlFor = checkbox.id;
        label.style.marginRight = "1.5vmax";
        label.appendChild(checkbox);
        label.append(` ${domain.domainShortName}`);

        checkbox.addEventListener("change", () => {
          if (checkbox.checked) {
            if (!filterState.visibleDomains.includes(domain.domainId)) {
              filterState.visibleDomains.push(domain.domainId);
            }
          } else {
            filterState.visibleDomains = filterState.visibleDomains.filter(id => id !== domain.domainId);
          }
          applyFiltersAndRedraw();
        });

        domainCheckboxes.appendChild(label);
      });
      // Normalize vendors before doing anything else
      const normalizedVendors = vendors.map(v => ({
        vendorId: v.id,
        vendorLabel: v.name
      }));
      window.normalizedVendors = normalizedVendors;

      // Seed visibleVendorIds with the correct values
      filterState.visibleVendorIds = normalizedVendors.map(v => v.vendorId);

      // Store for later use (for debugging or reuse)
      window.loadedDomains = domains;
      window.loadedSubdomains = subdomains;
      window.loadedCerts = certs;
      window.loadedVendors = vendors;          // Raw: [{ id, name }]
      window.normalizedVendors = normalizedVendors;  // Normalized: [{ vendorId, vendorLabel }]

      const vendorSelect = document.getElementById("vendor-filter");

      // Clear old options (if any)
      vendorSelect.innerHTML = "";

      // ‚ÄúAll Vendors‚Äù option ‚Äî FIRST and selected by default
        const allOption = document.createElement("option");
        allOption.value = "__ALL__";
        allOption.textContent = "All Vendors";
        allOption.selected = true; // default on page load
        vendorSelect.appendChild(allOption);

        // ‚ÄúNone‚Äù option ‚Äî SECOND
        const noneOption = document.createElement("option");
        noneOption.value = "__NONE__";
        noneOption.textContent = "None";
        vendorSelect.appendChild(noneOption);

      // Populate from normalizedVendors
      normalizedVendors.forEach(vendor => {
        const option = document.createElement("option");
        option.value = vendor.vendorId;
        option.textContent = vendor.vendorLabel || vendor.vendorId;
        vendorSelect.appendChild(option);
      });

      // Initial draw
      applyFiltersAndRedraw();
    });



    // Vendor dropdown
    document.getElementById("vendor-filter").addEventListener("change", (e) => {
    const selected = e.target.value;

    if (selected === "__NONE__") {
      // ‚ÄúNone‚Äù was selected ‚Üí show zero certs
      filterState.visibleVendorIds = [];
    } else if (selected === "__ALL__") {
      // ‚ÄúAll Vendors‚Äù was selected ‚Üí reset to every vendorId
      filterState.visibleVendorIds = window.normalizedVendors.map(v => v.vendorId);
    } else {
      // A single vendorId was selected ‚Üí filter to just that one
      filterState.visibleVendorIds = [selected];
    }

    applyFiltersAndRedraw();
  });

  // üåô Dark Mode Checkbox Listener
  const darkModeCheckbox = document.getElementById("dark-mode-checkbox");
  darkModeCheckbox.addEventListener("change", () => {
    document.body.classList.toggle("dark-mode", darkModeCheckbox.checked);
  });

</script>

</script>